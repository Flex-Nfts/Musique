<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SoundWave — Mobile Ready</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;800&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-deep: #0d0f14;
    --bg-panel: #13161e;
    --bg-card: #1a1e2a;
    --bg-hover: #1f2436;
    --accent: #4f6ef7;
    --accent-gradient: linear-gradient(90deg, #4f6ef7, #7c94f0);
    --import-red: #eb4d4b;
    --save-green: #27ae60;
    --save-hover: #2ecc71;
    --playlist-purple: #8e44ad;
    --text-primary: #e8eaf2;
    --text-secondary: #6b7394;
    --text-muted: #3d4260;
    --border: rgba(255,255,255,0.05);
    --sidebar-w: 240px;
    --player-h: 90px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg-deep); color: var(--text-primary); height: 100vh; overflow: hidden; }

  /* STRUCTURE ADAPTATIVE */
  .app { 
    display: grid; 
    grid-template-columns: var(--sidebar-w) 1fr; 
    grid-template-rows: 1fr var(--player-h); 
    height: 100vh; 
  }

  /* SIDEBAR */
  .sidebar { 
    background: var(--bg-panel); 
    border-right: 1px solid var(--border); 
    padding: 20px 12px; 
    display: flex; 
    flex-direction: column; 
    gap: 8px; 
    overflow-y: auto;
  }
  
  .section-header { display: flex; align-items: center; justify-content: space-between; margin: 15px 8px 5px 8px; }
  .section-label { font-family: 'Syne', sans-serif; font-size: 10px; text-transform: uppercase; color: var(--text-muted); letter-spacing: 1px; }
  
  .nav-item { 
    display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; 
    cursor: pointer; color: var(--text-secondary); transition: 0.2s; font-size: 14px; 
    margin-bottom: 2px;
  }
  .nav-item.active { background: var(--accent-gradient); color: white; }
  .nav-link { display: flex; align-items: center; gap: 12px; flex: 1; overflow: hidden; }
  .nav-item svg { width: 20px; height: 20px; flex-shrink: 0; }

  /* BOUTONS ACTIONS */
  .btn-purple { background: var(--playlist-purple); color: white; border: none; border-radius: 6px; width: 24px; height: 24px; cursor: pointer; font-weight: bold; }
  .save-controls { display: flex; gap: 8px; margin-top: auto; padding-top: 20px; }
  .badge-green { background: var(--save-green); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: 800; text-transform: uppercase; flex: 1; padding: 12px; }
  .import-badge-red { padding: 12px; background: var(--import-red); color: white; border-radius: 8px; border: none; width: 100%; margin-top: 8px; font-weight: 800; font-size: 11px; text-transform: uppercase; }

  /* MAIN CONTENT */
  .main { overflow-y: auto; padding: 20px; padding-bottom: 120px; }
  .view-title { font-family: 'Syne', sans-serif; font-size: 22px; margin-bottom: 20px; }

  /* LISTE DES PISTES */
  .track-item { 
    display: grid; 
    grid-template-columns: 50px 1fr 80px; 
    align-items: center; 
    padding: 10px; 
    border-radius: 12px; 
    margin-bottom: 8px;
    background: rgba(255,255,255,0.02);
  }
  .track-img { width: 45px; height: 45px; border-radius: 8px; object-fit: cover; }
  .track-info { padding-left: 12px; overflow: hidden; }
  .track-info div { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .track-actions { display: flex; gap: 15px; justify-content: flex-end; }

  /* PLAYER BAR */
  .player { 
    grid-column: 1 / 3; 
    background: #08090d; 
    border-top: 1px solid var(--border); 
    display: flex; 
    align-items: center; 
    padding: 0 20px;
    gap: 15px;
    z-index: 10;
  }
  .player-center { flex: 1; display: flex; align-items: center; gap: 12px; overflow: hidden; }
  .progress-container { flex: 1; display: flex; align-items: center; gap: 10px; }
  .progress-line-bg { flex: 1; height: 4px; background: #2a2d3a; border-radius: 2px; position: relative; }
  .progress-line-fill { height: 100%; background: var(--accent); width: 0%; border-radius: 2px; }

  /* MOBILE RESPONSIVE QUERIES */
  @media (max-width: 768px) {
    .app { grid-template-columns: 1fr; }
    .sidebar { 
        position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; 
        flex-direction: row; padding: 5px; z-index: 100; border-right: none; border-top: 1px solid var(--border);
        overflow-y: hidden; justify-content: space-around;
    }
    .section-label, .section-header, .save-controls, .import-badge-red, #custom-playlists-nav { display: none; }
    
    .main { padding: 15px; }
    .player { grid-column: 1 / 2; bottom: 60px; height: 80px; position: fixed; width: 100%; }
    .player-right { display: none; } /* On cache le volume sur mobile */
    
    .nav-item { padding: 8px; flex-direction: column; font-size: 10px; gap: 4px; flex: 1; }
    .nav-item svg { width: 22px; height: 22px; }
    .nav-link { flex-direction: column; gap: 2px; }
  }

  /* MODAL */
  .modal-content { width: 90% !important; max-width: 450px; }
</style>
</head>
<body>

<div class="app">
  <aside class="sidebar">
    <div class="section-label">Menu</div>
    <div class="nav-item active" id="nav-all" onclick="showView('all')">
      <div class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
        <span>Library</span>
      </div>
    </div>
    <div class="nav-item" id="nav-favorite" onclick="showView('favorite')">
      <div class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        <span>Favoris</span>
      </div>
    </div>

    <div class="section-header">
      <div class="section-label">Playlists</div>
      <div class="playlist-controls">
        <button class="btn-purple" onclick="createPlaylist()">+</button>
      </div>
    </div>
    <div id="custom-playlists-nav"></div>

    <div class="save-controls">
      <button class="badge-green" onclick="exportBackup()">Save</button>
      <button class="badge-green" style="background:#555; max-width:50px" onclick="document.getElementById('fileInput').click()">+</button>
    </div>
    <input type="file" id="fileInput" style="display:none" accept=".json" onchange="importBackup(event)">
    <button class="import-badge-red" onclick="toggleModal(true)">Import Manuel</button>
  </aside>

  <main class="main">
    <h1 class="view-title" id="mainTitle">Ma Musique</h1>
    <div class="track-list" id="trackList"></div>
  </main>

  <footer class="player">
    <div class="player-center">
      <img src="https://via.placeholder.com/45" class="mini-cover-player" id="npImage">
      <div class="track-info" style="flex: 1;">
        <div id="npTitle" style="font-size: 13px; font-weight: 600;">Aucun titre</div>
        <div class="progress-container">
            <div class="progress-line-bg" onclick="seek(event)"><div class="progress-line-fill" id="progressFill"></div></div>
        </div>
      </div>
    </div>
    <div class="player-actions">
        <button class="btn-img-style" onclick="togglePlay()" style="background:var(--accent); border:none; border-radius:50%; width:45px; height:45px; color:white; display:flex; align-items:center; justify-content:center;">
            <svg id="playIcon" viewBox="0 0 24 24" width="24" height="24" fill="white"><path d="M8 5v14l11-7z"/></svg>
        </button>
    </div>
  </footer>
</div>

<div class="modal" id="importModal">
  <div class="modal-content">
    <h2 style="font-size:18px">Ajouter un titre</h2>
    <textarea id="importInput" placeholder="Titre | Artiste | Lien URL"></textarea>
    <div style="display:flex; justify-content:flex-end; gap:10px">
      <button onclick="toggleModal(false)" style="color:white; background:none; border:none;">Annuler</button>
      <button onclick="processImport()" style="background:var(--accent); color:white; padding:10px 20px; border-radius:8px; border:none; font-weight:bold;">AJOUTER</button>
    </div>
  </div>
</div>

<audio id="mainAudio"></audio>

<script>
  let tracks = [];
  let favorites = [];
  let customPlaylists = {}; 
  let currentView = 'all'; 
  let currentIdx = -1;
  const audio = document.getElementById('mainAudio');

  function toggleModal(show) { document.getElementById('importModal').classList.toggle('open', show); }

  function createPlaylist() {
    const name = prompt("Nom de la playlist :");
    if(name && !customPlaylists[name]) {
      customPlaylists[name] = [];
      renderPlaylistsNav();
      showView(name);
    }
  }

  function renderPlaylistsNav() {
    const nav = document.getElementById('custom-playlists-nav');
    nav.innerHTML = Object.keys(customPlaylists).map(name => `
      <div class="nav-item" id="nav-${name}" onclick="showView('${name}')">
        <div class="nav-link"><span>${name}</span></div>
        <button class="btn-rename-nav" onclick="renamePlaylist(event, '${name}')" style="background:none; border:none; color:gray">✎</button>
      </div>
    `).join('');
  }

  function showView(view) {
    currentView = view;
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    if(document.getElementById('nav-' + view)) document.getElementById('nav-' + view).classList.add('active');
    document.getElementById('mainTitle').innerText = view === 'all' ? "Bibliothèque" : (view === 'favorite' ? "Favoris" : view);
    render();
  }

  function exportBackup() {
    const data = JSON.stringify({ tracks, favorites, customPlaylists });
    const blob = new Blob([data], { type: "application/json" });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "music_backup.json";
    a.click();
  }

  function importBackup(event) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const json = JSON.parse(e.target.result);
      tracks = json.tracks || [];
      favorites = json.favorites || [];
      customPlaylists = json.customPlaylists || {};
      renderPlaylistsNav(); render();
    };
    reader.readAsText(event.target.files[0]);
  }

  function processImport() {
    const input = document.getElementById('importInput').value;
    input.split('\n').forEach(line => {
      if(line.includes('|')) {
        const [title, artist, url] = line.split('|').map(s => s.trim());
        tracks.push({ title, artist, url, cover: `https://picsum.photos/seed/${Math.random()}/200` });
      }
    });
    render(); toggleModal(false);
  }

  function render() {
    const list = document.getElementById('trackList');
    let displayList = currentView === 'all' ? tracks : (currentView === 'favorite' ? favorites : customPlaylists[currentView] || []);

    list.innerHTML = displayList.map((t, i) => `
      <div class="track-item" onclick="playFromCurrentView(${i})">
        <img src="${t.cover}" class="track-img">
        <div class="track-info">
          <div style="font-weight:600">${t.title}</div>
          <div style="font-size:11px; color:var(--text-secondary)">${t.artist}</div>
        </div>
        <div class="track-actions">
          <button class="btn-action" onclick="toggleFav(event, ${i})" style="color:${favorites.some(f => f.url === t.url) ? '#f7d794' : 'gray'}">❤</button>
          <button class="btn-action" onclick="deleteTrack(event, ${i})" style="color:gray">✕</button>
        </div>
      </div>
    `).join('');
  }

  function playFromCurrentView(i) {
    let list = currentView === 'all' ? tracks : (currentView === 'favorite' ? favorites : customPlaylists[currentView]);
    const t = list[i]; currentIdx = i;
    document.getElementById('npTitle').innerText = t.title;
    document.getElementById('npImage').src = t.cover;
    audio.src = t.url; audio.play(); updatePlayIcon(true);
  }

  function togglePlay() {
    if(!audio.src && tracks.length) return playFromCurrentView(0);
    audio.paused ? (audio.play(), updatePlayIcon(true)) : (audio.pause(), updatePlayIcon(false));
  }

  function updatePlayIcon(playing) {
    document.getElementById('playIcon').innerHTML = playing ? '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>' : '<path d="M8 5v14l11-7z"/>';
  }

  function toggleFav(e, i) {
    e.stopPropagation();
    let list = currentView === 'all' ? tracks : (currentView === 'favorite' ? favorites : customPlaylists[currentView]);
    const t = list[i];
    const fIdx = favorites.findIndex(f => f.url === t.url);
    fIdx > -1 ? favorites.splice(fIdx, 1) : favorites.push(t);
    render();
  }

  function deleteTrack(e, i) {
    e.stopPropagation();
    if(currentView === 'all') tracks.splice(i, 1);
    else if(currentView === 'favorite') favorites.splice(i, 1);
    else customPlaylists[currentView].splice(i, 1);
    render();
  }

  function seek(e) { audio.currentTime = (e.offsetX / e.target.offsetWidth) * audio.duration; }
  
  audio.ontimeupdate = () => {
    if(!audio.duration) return;
    document.getElementById('progressFill').style.width = (audio.currentTime / audio.duration) * 100 + '%';
  };
</script>
</body>
</html>
