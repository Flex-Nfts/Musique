<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoundVault Cloud Fix</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background: #121212; color: white; font-family: 'Nunito', sans-serif; padding: 20px; }
        .box { background: #181818; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        textarea { width: 100%; height: 100px; background: #282828; color: white; border: 1px solid #spotify-green; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { background: #1DB954; color: black; border: none; padding: 15px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; }
        .track { background: #282828; padding: 10px; margin-top: 5px; border-radius: 5px; display: flex; justify-content: space-between; }
        .play-btn { background: white; color: black; border-radius: 50%; width: 40px; height: 40px; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <div class="box">
        <h1>Mon Spotify PrivÃ©</h1>
        <p>Colle ta liste ici (Format : Nom | Artiste | Lien)</p>
        <textarea id="bulkInput" placeholder="Exemple : Rai 01 | Suno | https://www.dropbox.com/s/xyz/01.mp3?dl=0"></textarea>
        <br>
        <button onclick="ajouterMusique()">ðŸš€ IMPORTER MA LISTE</button>
    </div>

    <div id="liste" style="margin-top:20px;"></div>

    <script>
        let maListe = JSON.parse(localStorage.getItem('maMusique')) || [];

        function ajouterMusique() {
            const texte = document.getElementById('bulkInput').value;
            const lignes = texte.split('\n');
            let ajouts = 0;

            lignes.forEach(ligne => {
                if(ligne.includes('|')) {
                    let infos = ligne.split('|');
                    let titre = infos[0].trim();
                    let artiste = infos[1].trim();
                    let url = infos[2] ? infos[2].trim() : "";

                    if(url.includes('http')) {
                        // On transforme le lien Dropbox automatiquement
                        url = url.replace('?dl=0', '?raw=1');
                        maListe.push({ titre, artiste, url });
                        ajouts++;
                    } else {
                        alert("Erreur : Le lien pour '" + titre + "' n'est pas une adresse web (URL)");
                    }
                }
            });

            if(ajouts > 0) {
                localStorage.setItem('maMusique', JSON.stringify(maListe));
                alert(ajouts + " musique(s) ajoutÃ©e(s) !");
                afficher();
            } else {
                alert("Rien n'a Ã©tÃ© ajoutÃ©. VÃ©rifie que tu as bien mis le signe | entre le nom et le lien.");
            }
        }

        function afficher() {
            const div = document.getElementById('liste');
            div.innerHTML = maListe.map((m, i) => `
                <div class="track">
                    <span><strong>${m.titre}</strong> - ${m.artiste}</span>
                    <button class="play-btn" onclick="jouer('${m.url}')">â–¶</button>
                    <button onclick="supprimer(${i})" style="background:none; color:red; border:none; cursor:pointer;">X</button>
                </div>
            `).join('');
        }

        let audio = new Audio();
        function jouer(url) {
            audio.src = url;
            audio.play();
        }

        function supprimer(i) {
            maListe.splice(i, 1);
            localStorage.setItem('maMusique', JSON.stringify(maListe));
            afficher();
        }

        afficher();
    </script>
</body>
</html>
