<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SoundWave ‚Äî Multi-Device</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;800&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-deep: #0d0f14;
    --bg-panel: #13161e;
    --bg-card: #1a1e2a;
    --bg-hover: #1f2436;
    --accent: #4f6ef7;
    --accent-gradient: linear-gradient(90deg, #4f6ef7, #7c94f0);
    --import-red: #eb4d4b;
    --save-green: #27ae60;
    --playlist-purple: #8e44ad;
    --text-primary: #e8eaf2;
    --text-secondary: #6b7394;
    --text-muted: #3d4260;
    --border: rgba(255,255,255,0.05);
    --sidebar-w: 260px;
    --player-h: 90px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg-deep); color: var(--text-primary); height: 100vh; overflow: hidden; }

  /* STRUCTURE ADAPTATIVE */
  .app { 
    display: grid; 
    grid-template-columns: var(--sidebar-w) 1fr; 
    grid-template-rows: 1fr var(--player-h); 
    height: 100vh; 
    transition: all 0.3s ease;
  }

  /* SIDEBAR RESPONSIVE */
  .sidebar { 
    background: var(--bg-panel); 
    border-right: 1px solid var(--border); 
    padding: 20px 12px; 
    display: flex; 
    flex-direction: column; 
    gap: 8px; 
    z-index: 100;
  }

  .mobile-header { display: none; padding: 15px; background: var(--bg-panel); border-bottom: 1px solid var(--border); align-items: center; justify-content: space-between; }

  /* TABLETTE & MOBILE (< 900px) */
  @media (max-width: 900px) {
    .app { grid-template-columns: 1fr; }
    .sidebar { 
      position: fixed; 
      left: -100%; 
      top: 0; 
      bottom: var(--player-h); 
      width: 280px; 
      transition: 0.3s ease; 
    }
    .sidebar.open { left: 0; box-shadow: 20px 0 50px rgba(0,0,0,0.5); }
    .mobile-header { display: flex; }
    .main { padding: 15px !important; }
  }

  /* CONTENUS */
  .section-header { display: flex; align-items: center; justify-content: space-between; margin: 15px 8px 5px 8px; }
  .section-label { font-family: 'Syne', sans-serif; font-size: 10px; text-transform: uppercase; color: var(--text-muted); letter-spacing: 1px; }
  
  .nav-item { 
    display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; 
    cursor: pointer; color: var(--text-secondary); transition: 0.2s; font-size: 14px;
  }
  .nav-item.active { background: var(--accent-gradient); color: white; }
  .nav-link { display: flex; align-items: center; gap: 12px; flex: 1; overflow: hidden; }
  .nav-item svg { width: 18px; flex-shrink: 0; }

  .btn-rename-nav { opacity: 0.5; font-size: 12px; background: none; border: none; color: inherit; cursor: pointer; padding: 5px; }

  /* BOUTONS ACTIONS */
  .btn-purple { background: var(--playlist-purple); color: white; border: none; border-radius: 5px; width: 24px; height: 24px; cursor: pointer; }
  .save-controls { display: flex; gap: 8px; margin-top: auto; padding-top: 20px; }
  .badge-green { background: var(--save-green); color: white; border: none; border-radius: 8px; padding: 10px; cursor: pointer; font-size: 12px; font-weight: 800; flex: 1; }
  .btn-load-file { width: 45px; }
  .import-badge-red { background: var(--import-red); color: white; border: none; border-radius: 8px; padding: 12px; cursor: pointer; font-weight: 800; margin-top: 8px; }

  /* LISTE DE LECTURE */
  .main { overflow-y: auto; padding: 30px; }
  .view-title { font-family: 'Syne', sans-serif; font-size: clamp(20px, 5vw, 28px); margin-bottom: 20px; }

  .track-item { 
    display: grid; 
    grid-template-columns: 40px 50px 1fr 80px; 
    align-items: center; 
    padding: 10px; 
    border-radius: 12px; 
    margin-bottom: 8px;
    cursor: pointer;
  }
  .track-item:hover { background: var(--bg-card); }
  .track-img { width: 44px; height: 44px; border-radius: 8px; object-fit: cover; }
  .track-info { padding: 0 10px; overflow: hidden; }
  .track-info div { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .track-actions { display: flex; justify-content: flex-end; gap: 10px; }

  /* PLAYER BAR RESPONSIVE */
  .player { 
    grid-column: 1 / 3; 
    background: #08090d; 
    border-top: 1px solid var(--border); 
    display: grid; 
    grid-template-columns: 1fr 2fr 1fr;
    align-items: center; 
    padding: 0 20px; 
  }

  @media (max-width: 600px) {
    .player { grid-template-columns: 1fr 1fr; padding: 10px; }
    .player-right { display: none !important; }
    .progress-container { position: absolute; top: -2px; left: 0; width: 100%; padding: 0 !important; }
    .time-stamp { display: none; }
    .track-meta { max-width: 120px; }
  }

  .player-center { display: flex; flex-direction: column; align-items: center; gap: 5px; }
  .controls-row { display: flex; align-items: center; gap: 20px; }
  .progress-container { width: 100%; display: flex; align-items: center; gap: 10px; }
  .progress-line-bg { flex: 1; height: 4px; background: #222; border-radius: 2px; position: relative; cursor: pointer; }
  .progress-line-fill { height: 100%; background: var(--accent); width: 0%; border-radius: 2px; }

  .btn-player { background: none; border: none; color: white; cursor: pointer; }
  .btn-player svg { width: 28px; height: 28px; fill: currentColor; }

  /* MODAL */
  .modal-content { background: var(--bg-panel); padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; }
  textarea { width: 100%; height: 120px; background: #000; border: 1px solid var(--border); color: #fff; border-radius: 8px; padding: 10px; margin: 15px 0; }
</style>
</head>
<body>

<div class="mobile-header">
  <button onclick="toggleSidebar()" style="background:none; border:none; color:white;">
    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
  </button>
  <div style="font-family:'Syne'; font-weight:800; font-size:18px;">SOUNDWAVE</div>
  <div style="width:24px;"></div>
</div>

<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="section-label">Menu</div>
    <div class="nav-item active" id="nav-all" onclick="showView('all')">
      <div class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
        Biblioth√®que
      </div>
    </div>
    <div class="nav-item" id="nav-favorite" onclick="showView('favorite')">
      <div class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        Favoris
      </div>
    </div>

    <div class="section-header">
      <div class="section-label">Mes Playlists</div>
      <div style="display:flex; gap:5px;">
        <button class="btn-purple" onclick="createPlaylist()">+</button>
        <button class="btn-purple" onclick="deleteCurrentPlaylist()">-</button>
      </div>
    </div>
    <div id="custom-playlists-nav" style="flex:1; overflow-y:auto;"></div>

    <div class="save-controls">
      <button class="badge-green" onclick="exportBackup()">SAVE</button>
      <button class="badge-green btn-load-file" onclick="document.getElementById('fileInput').click()">üìÅ</button>
    </div>
    <input type="file" id="fileInput" style="display:none" accept=".json" onchange="importBackup(event)">
    <button class="import-badge-red" onclick="toggleModal(true)">IMPORT MANUEL</button>
  </aside>

  <main class="main" onclick="closeSidebarMobile()">
    <h1 class="view-title" id="mainTitle">Biblioth√®que</h1>
    <div id="trackList"></div>
  </main>

  <footer class="player">
    <div style="display:flex; align-items:center; gap:10px; overflow:hidden;">
      <img src="" id="npImage" class="mini-cover-player" style="width:45px; height:45px; border-radius:5px; background:#222;">
      <div class="track-meta" style="overflow:hidden;">
        <div id="npTitle" style="font-size:13px; font-weight:600; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;">Pr√™t √† lire</div>
        <div id="npArtist" style="font-size:11px; color:var(--text-secondary);">S√©lectionnez un titre</div>
      </div>
    </div>

    <div class="player-center">
      <div class="controls-row">
        <button class="btn-player" onclick="prevTrack()"><svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
        <button class="btn-player" onclick="togglePlay()"><svg id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
        <button class="btn-player" onclick="nextTrack()"><svg viewBox="0 0 24 24"><path d="M16 6h2v12h-2zm-10.5 0v12l8.5-6z"/></svg></button>
      </div>
      <div class="progress-container">
        <span class="time-stamp" id="curTime">0:00</span>
        <div class="progress-line-bg" id="pBar" onclick="seek(event)"><div class="progress-line-fill" id="progressFill"></div></div>
        <span class="time-stamp" id="totTime">0:00</span>
      </div>
    </div>

    <div class="player-right" style="display:flex; align-items:center; gap:10px; justify-content:flex-end;">
      <svg width="16" height="16" fill="white" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
      <input type="range" min="0" max="1" step="0.01" value="0.8" style="width:80px;" oninput="audio.volume = this.value">
    </div>
  </footer>
</div>

<div class="modal" id="importModal">
  <div class="modal-content">
    <h2 style="margin-bottom:10px;">Ajouter Musique</h2>
    <textarea id="importInput" placeholder="Titre | Artiste | Lien URL"></textarea>
    <div style="display:flex; justify-content:flex-end; gap:10px;">
      <button onclick="toggleModal(false)" style="color:#aaa; background:none; border:none; cursor:pointer;">Annuler</button>
      <button onclick="processImport()" style="background:var(--accent); color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">Ajouter</button>
    </div>
  </div>
</div>

<audio id="mainAudio"></audio>

<script>
  let tracks = [];
  let favorites = [];
  let customPlaylists = {}; 
  let currentView = 'all'; 
  let currentIdx = -1;
  const audio = document.getElementById('mainAudio');

  // FONCTIONS INTERFACE
  function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
  function closeSidebarMobile() { if(window.innerWidth < 900) document.getElementById('sidebar').classList.remove('open'); }
  function toggleModal(s) { document.getElementById('importModal').classList.toggle('open', s); }

  // GESTION PLAYLISTS
  function createPlaylist() {
    const name = prompt("Nom de la playlist :");
    if(name && !customPlaylists[name]) {
      customPlaylists[name] = [];
      renderPlaylistsNav();
    }
  }

  function renamePlaylist(e, oldName) {
    e.stopPropagation();
    const newName = prompt("Nouveau nom :", oldName);
    if(newName && newName !== oldName && !customPlaylists[newName]) {
      customPlaylists[newName] = customPlaylists[oldName];
      delete customPlaylists[oldName];
      if(currentView === oldName) currentView = newName;
      renderPlaylistsNav();
      showView(currentView);
    }
  }

  function deleteCurrentPlaylist() {
    if(currentView !== 'all' && currentView !== 'favorite' && confirm("Supprimer ?")) {
      delete customPlaylists[currentView];
      renderPlaylistsNav();
      showView('all');
    }
  }

  function renderPlaylistsNav() {
    const nav = document.getElementById('custom-playlists-nav');
    nav.innerHTML = Object.keys(customPlaylists).map(name => `
      <div class="nav-item ${currentView === name ? 'active' : ''}" onclick="showView('${name}')">
        <div class="nav-link"><span>${name}</span></div>
        <button class="btn-rename-nav" onclick="renamePlaylist(event, '${name}')">‚úé</button>
      </div>
    `).join('');
  }

  function showView(v) {
    currentView = v;
    closeSidebarMobile();
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    const activeNav = document.getElementById('nav-' + v) || [...document.querySelectorAll('.nav-item')].find(el => el.innerText.includes(v));
    if(activeNav) activeNav.classList.add('active');
    document.getElementById('mainTitle').innerText = v === 'all' ? 'Biblioth√®que' : (v === 'favorite' ? 'Favoris' : v);
    render();
  }

  // LOGIQUE AUDIO & TRACKS
  function processImport() {
    const val = document.getElementById('importInput').value;
    val.split('\n').forEach(line => {
      if(line.includes('|')) {
        const [t, a, u] = line.split('|').map(s => s.trim());
        tracks.push({ title: t, artist: a, url: u, cover: `https://picsum.photos/seed/${Math.random()}/200` });
      }
    });
    render(); toggleModal(false); document.getElementById('importInput').value = "";
  }

  function render() {
    const container = document.getElementById('trackList');
    let list = currentView === 'all' ? tracks : (currentView === 'favorite' ? favorites : customPlaylists[currentView] || []);
    
    container.innerHTML = list.map((t, i) => {
      const isFav = favorites.some(f => f.url === t.url);
      return `
        <div class="track-item" onclick="playTrack(${i})">
          <div style="font-size:11px; color:var(--text-muted);">${i+1}</div>
          <img src="${t.cover}" class="track-img">
          <div class="track-info">
            <div style="font-weight:600; font-size:14px;">${t.title}</div>
            <div style="font-size:12px; color:var(--text-secondary);">${t.artist}</div>
          </div>
          <div class="track-actions">
            <button class="btn-player" style="color:var(--playlist-purple)" onclick="addToPlaylist(event, ${i})">+</button>
            <button class="btn-player" style="color:${isFav?'#f1c40f':''}" onclick="toggleFav(event, ${i})">‚ù§</button>
          </div>
        </div>
      `;
    }).join('');
  }

  function playTrack(i) {
    let list = currentView === 'all' ? tracks : (currentView === 'favorite' ? favorites : customPlaylists[currentView]);
    const t = list[i];
    currentIdx = i;
    document.getElementById('npTitle').innerText = t.title;
    document.getElementById('npArtist').innerText = t.artist;
    document.getElementById('npImage').src = t.cover;
    audio.src = t.url; audio.play();
    updatePlayIcon(true);
  }

  function togglePlay() {
    if(!audio.src && tracks.length) playTrack(0);
    else audio.paused ? (audio.play(), updatePlayIcon(true)) : (audio.pause(), updatePlayIcon(false));
  }

  function updatePlayIcon(p) {
    document.getElementById('playIcon').innerHTML = p ? '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>' : '<path d="M8 5v14l11-7z"/>';
  }

  function nextTrack() { if(currentIdx < tracks.length - 1) playTrack(currentIdx + 1); }
  function prevTrack() { if(currentIdx > 0) playTrack(currentIdx - 1); }

  function toggleFav(e, i) {
    e.stopPropagation();
    let t = tracks[i];
    let idx = favorites.findIndex(f => f.url === t.url);
    idx > -1 ? favorites.splice(idx, 1) : favorites.push(t);
    render();
  }

  function addToPlaylist(e, i) {
    e.stopPropagation();
    const pName = prompt("Nom de la playlist destination :");
    if(customPlaylists[pName]) {
      customPlaylists[pName].push(tracks[i]);
      alert("Ajout√© !");
    }
  }

  function seek(e) { audio.currentTime = (e.offsetX / document.getElementById('pBar').offsetWidth) * audio.duration; }

  function exportBackup() {
    const blob = new Blob([JSON.stringify({tracks, favorites, customPlaylists})], {type: "application/json"});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "music_save.json"; a.click();
  }

  function importBackup(e) {
    const reader = new FileReader();
    reader.onload = (ev) => {
      const data = JSON.parse(ev.target.result);
      tracks = data.tracks; favorites = data.favorites; customPlaylists = data.customPlaylists;
      renderPlaylistsNav(); render();
    };
    reader.readAsText(e.target.files[0]);
  }

  audio.ontimeupdate = () => {
    if(!audio.duration) return;
    const pct = (audio.currentTime / audio.duration) * 100;
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('curTime').innerText = Math.floor(audio.currentTime/60)+":"+String(Math.floor(audio.currentTime%60)).padStart(2,'0');
    document.getElementById('totTime').innerText = Math.floor(audio.duration/60)+":"+String(Math.floor(audio.duration%60)).padStart(2,'0');
  };
</script>
</body>
</html>
