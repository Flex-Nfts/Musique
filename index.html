<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoundVault Fix</title>
    <style>
        :root { --green: #1DB954; --bg: #121212; --card: #181818; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; display: flex; height: 100vh; }
        
        /* SIDEBAR */
        .sidebar { width: 250px; background: black; padding: 20px; border-right: 1px solid #282828; }
        .nav-btn { padding: 10px; cursor: pointer; display: block; width: 100%; text-align: left; background: none; color: #b3b3b3; border: none; font-size: 16px; }
        .nav-btn:hover { color: white; }

        /* MAIN */
        .main { flex: 1; padding: 20px; overflow-y: auto; padding-bottom: 120px; }
        .import-zone { background: var(--card); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        textarea { width: 100%; height: 60px; background: #282828; color: white; border: 1px solid #333; margin: 10px 0; border-radius: 4px; padding: 10px; }
        
        /* TRACKS */
        .track { display: grid; grid-template-columns: 1fr 1fr 120px; padding: 10px; border-bottom: 1px solid #282828; align-items: center; }
        .track:hover { background: #282828; }
        .btn-heart { background: none; border: none; cursor: pointer; font-size: 20px; color: #555; }
        .btn-heart.active { color: #e91e63; }

        /* BARRE DE LECTURE (EN BAS) */
        .player-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #000; height: 90px; display: flex; align-items: center; padding: 0 20px; border-top: 1px solid #282828; }
        .controls { flex: 1; text-align: center; }
        .vol-zone { width: 200px; display: flex; align-items: center; gap: 10px; }
        
        button.circle { width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer; font-weight: bold; }
        .play-btn { background: white; color: black; font-size: 20px; }
        
        .progress-bg { width: 100%; max-width: 500px; height: 4px; background: #4f4f4f; margin: 10px auto; border-radius: 2px; cursor: pointer; position: relative; }
        .progress-fill { height: 100%; background: var(--green); width: 0%; border-radius: 2px; }
    </style>
</head>
<body>

<div class="sidebar">
    <h3>Ma Biblio</h3>
    <button class="nav-btn" onclick="filterPl('Toutes')">üè† Accueil</button>
    <button class="nav-btn" onclick="filterPl('Favoris')">‚ù§Ô∏è Favoris</button>
    <hr>
    <button class="nav-btn" onclick="addPlaylist()">+ Cr√©er Playlist</button>
    <div id="plDisplay"></div>
</div>

<div class="main">
    <div class="import-zone">
        <strong>Ajout Rapide</strong> (Nom | Artiste | Lien Dropbox)
        <textarea id="bulkText" placeholder="Ex: Rai 01 | Suno | https://..."></textarea>
        <button onclick="importNow()" style="background:var(--green); border:none; padding:10px 20px; border-radius:20px; font-weight:bold; cursor:pointer;">üöÄ Importer</button>
    </div>
    
    <h2 id="viewTitle">Toutes les musiques</h2>
    <div id="trackList"></div>
</div>

<div class="player-bar">
    <div style="width:200px;">
        <div id="nowT" style="font-weight:bold; font-size:14px;">---</div>
        <div id="nowA" style="font-size:12px; color:#b3b3b3;">Choisissez un titre</div>
    </div>

    <div class="controls">
        <button onclick="prev()" style="background:none; color:white; border:none; font-size:20px; cursor:pointer;">‚èÆ</button>
        <button class="circle play-btn" id="playB" onclick="toggleP()">‚ñ∂</button>
        <button onclick="next()" style="background:none; color:white; border:none; font-size:20px; cursor:pointer;">‚è≠</button>
        <div class="progress-bg" onclick="seek(event)">
            <div class="progress-fill" id="pFill"></div>
        </div>
    </div>

    <div class="vol-zone">
        <span>üîà</span>
        <input type="range" min="0" max="100" value="80" oninput="changeVol(this.value)">
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('myMusicDB')) || { tracks: [], playlists: {}, view: 'Toutes' };
    let player = new Audio();

    function save() { localStorage.setItem('myMusicDB', JSON.stringify(db)); render(); }

    function importNow() {
        let lines = document.getElementById('bulkText').value.split('\n');
        lines.forEach(l => {
            if(l.includes('|')) {
                let [t, a, u] = l.split('|').map(s => s.trim());
                if(u) {
                    u = u.replace('dl=0', 'raw=1');
                    db.tracks.push({ id: Date.now() + Math.random(), t, a, u, fav: false });
                }
            }
        });
        document.getElementById('bulkText').value = "";
        save();
    }

    function render() {
        let list = db.tracks;
        if(db.view === 'Favoris') list = db.tracks.filter(t => t.fav);
        
        document.getElementById('viewTitle').innerText = db.view;
        document.getElementById('trackList').innerHTML = list.map((t, i) => `
            <div class="track">
                <div onclick="playMe(${db.tracks.indexOf(t)})"><strong>${t.t}</strong></div>
                <div style="color:#b3b3b3">${t.a}</div>
                <div>
                    <button class="btn-heart ${t.fav?'active':''}" onclick="toggleF(${t.id})">‚ù§</button>
                    <button onclick="delT(${t.id})" style="background:none; border:none; color:red; cursor:pointer;">üóë</button>
                </div>
            </div>
        `).join('');
    }

    function playMe(idx) {
        let t = db.tracks[idx];
        document.getElementById('nowT').innerText = t.t;
        document.getElementById('nowA').innerText = t.a;
        player.src = t.u;
        player.play();
        document.getElementById('playB').innerText = '‚è∏';
    }

    function toggleP() {
        if(player.paused) { player.play(); document.getElementById('playB').innerText = '‚è∏'; }
        else { player.pause(); document.getElementById('playB').innerText = '‚ñ∂'; }
    }

    function changeVol(v) { player.volume = v/100; }
    function toggleF(id) { let t = db.tracks.find(x => x.id === id); t.fav = !t.fav; save(); }
    function delT(id) { db.tracks = db.tracks.filter(t => t.id !== id); save(); }
    function filterPl(name) { db.view = name; render(); }

    player.ontimeupdate = () => {
        let p = (player.currentTime / player.duration) * 100;
        document.getElementById('pFill').style.width = p + '%';
    };

    render();
</script>
</body>
</html>
